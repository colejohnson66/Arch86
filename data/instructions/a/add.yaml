%YAML 1.2
---
title: Add
opcode:
  - opcode: 04 \i{ib}
    mnemonic: ADD AL, \i{imm8}
    encoding: AI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm8} to \reg{AL}.
  - opcode: 05 \i{iw}
    mnemonic: ADD AX, \i{imm16}
    encoding: AI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm16} to \reg{AX}.
  - opcode: 05 \i{id}
    mnemonic: ADD EAX, \i{imm32}
    encoding: AI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm32} to \reg{EAX}.
  - opcode: REX.W 05 \i{id}
    mnemonic: ADD RAX, \i{imm32}
    encoding: AI
    validity:
      16: n/e
      32: n/e
      64: valid
    description: Adds \i{imm32} (sign extended to 64 bits) to \reg{RAX}.
  - opcode: 80 /0 \i{ib}
    mnemonic: ADD \i{r/m8}, \i{imm8}
    encoding: MI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm8} into \i{r/m8}.
  - opcode: REX 80 /0 \i{ib}
    mnemonic: ADD \i{r/m8*}, \i{imm8}
    encoding: MI
    validity:
      16: n/e
      32: n/e
      64: valid
    description: Adds \i{imm8} into \i{r/m8}.
  - opcode: 81 /0 \i{iw}
    mnemonic: ADD \i{r/m16}, \i{imm16}
    encoding: MI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm16} into \i{r/m16}.
  - opcode: 81 /0 \i{id}
    mnemonic: ADD \i{r/m32}, \i{imm32}
    encoding: MI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm32} into \i{r/m32}.
  - opcode: REX.W 81 /0 \i{id}
    mnemonic: ADD \i{r/m64}, \i{imm32}
    encoding: MI
    validity:
      16: n/e
      32: n/e
      64: valid
    description: Adds \i{imm32} into \i{r/m64}.
  - opcode: 82 /0 \i{ib}
    mnemonic: ADD \i{r/m8}, \i{imm8}
    encoding: MI
    validity:
      16: valid
      32: valid
      64: invalid
    description: >-
      Undocumented alias for \c{80 /0 ib}.
      Adds \i{imm8} (sign extended to 8 bits) into \i{r/m8}.
  - opcode: 83 /0 \i{ib}
    mnemonic: ADD \i{r/m16}, \i{imm8}
    encoding: MI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm8} (sign extended to 16 bits) into \i{r/m16}.
  - opcode: 83 /0 \i{ib}
    mnemonic: ADD \i{r/m32}, \i{imm8}
    encoding: MI
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{imm8} (sign extended to 32 bits) into \i{r/m32}.
  - opcode: REX.W 83 /0 \i{ib}
    mnemonic: ADD \i{r/m64}, \i{imm8}
    encoding: MI
    validity:
      16: n/e
      32: n/e
      64: valid
    description: Adds \i{imm8} (sign extended to 64 bits) into \i{r/m64}.
  - opcode: 00 /r
    mnemonic: ADD \i{r/m8}, \i{r8}
    encoding: MR
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{r8} into \i{r/m8}.
  - opcode: REX 00 /r
    mnemonic: ADD \i{r/m8}, \i{r8}
    encoding: MR
    validity:
      16: n/e
      32: n/e
      64: valid
    description: >-
      Adds \i{r8} into \i{r/m8}.
      \canned{alternateR8Encoding}
  - opcode: 01 /r
    mnemonic: ADD \i{r/m16}, \i{r16}
    encoding: MR
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{r16} into \i{r/m16}.
  - opcode: 01 /r
    mnemonic: ADD \i{r/m32}, \i{r32}
    encoding: MR
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{r32} into \i{r/m32}.
  - opcode: REX.W 01 /r
    mnemonic: ADD \i{r/m64}, \i{r64}
    encoding: MR
    validity:
      16: n/e
      32: n/e
      64: valid
    description: Adds \i{r64} into \i{r/m64}.
  - opcode: 02 /r
    mnemonic: ADD \i{r8}, \i{r/m8}
    encoding: RM
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{r/m8} into \i{r/8}.
  - opcode: REX 02 /r
    mnemonic: ADD \i{r8}, \i{r/m8}
    encoding: RM
    validity:
      16: n/e
      32: n/e
      64: valid
    description: >-
      Adds \i{r/m8} into \i{r8}.
      \canned{alternateR8Encoding}
  - opcode: 03 /r
    mnemonic: ADD \i{r16}, \i{r/m16}
    encoding: RM
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{r/m16} into \i{r16}.
  - opcode: 03 /r
    mnemonic: ADD \i{r32}, \i{r/m32}
    encoding: RM
    validity:
      16: valid
      32: valid
      64: valid
    description: Adds \i{r/m32} into \i{r32}.
  - opcode: REX.W 03 /r
    mnemonic: ADD \i{r64}, \i{r/m64}
    encoding: RM
    validity:
      16: n/e
      32: n/e
      64: valid
    description: Adds \i{r/m64} into \i{r64}.
encoding:
  operands: 2
  encodings:
    AI:
      - AL/AX/EAX/RAX[rw]
      - imm8/16/32[r]
    MI:
      - ModRM.r/m[rw]
      - imm8/16/32[r]
    MR:
      - ModRM.r/m[rw]
      - ModRM.reg[r]
    RM:
      - ModRM.reg[rw]
      - ModRM.r/m[r]
description: >-
  The \c{ADD} instruction adds the destination operand with the source operand and stores the result in the destination operand.

  \canned{lockable}
operation: |-
  // `src` is sign extended to the width of `dest`

  public void ADD_8(ref byte dest, byte src)
  {
    CF:dest = dest + src;
  }

  public void ADD_16(ref ushort dest, ushort src)
  {
    CF:dest = dest + src;
  }

  public void ADD_32(ref uint dest, uint src)
  {
    CF:dest = dest + src;
  }

  public void ADD_64(ref ulong dest, ulong src)
  {
    CF:dest = dest + src;
  }
flags:
  CF: Set according to the result.
  PF: Set according to the result.
  AF: Set according to the result.
  ZF: Set according to the result.
  SF: Set according to the result.
  OF: Set according to the result.
exceptions:
  real:
    "#GP": \exception{segLimit}
    "#SS": \exception{segLimitSS}
    "#UD": \exception{lockNoMem}
  virtual:
    "#GP(0)": \exception{segLimit}
    "#SS(0)": \exception{segLimitSS}
    "#PF(fc)": \exception{pf}
    "#AC(0)": \exception{ac}
    "#UD": \exception{lockNoMem}
  protected:
    "#GP(0)":
      - \exception{nonWritableSegment}
      - \exception{segLimit}
      - \exception{nullSelector}
    "#SS(0)": \exception{segLimitSS}
    "#PF(fc)": \exception{pf}
    "#AC(0)": \exception{ac}
    "#UD": \exception{lockNoMem}
  compatibility:
    "#GP(0)":
      - \exception{nonWritableSegment}
      - \exception{segLimit}
      - \exception{nullSelector}
    "#SS(0)": \exception{segLimitSS}
    "#PF(fc)": \exception{pf}
    "#AC(0)": \exception{ac}
    "#UD": \exception{lockNoMem}
  long:
    "#GP(0)":
      - \exception{nonWritableSegment}
      - \exception{segLimit}
      - \exception{nullSelector}
      - \exception{nonCanon}
    "#SS(0)":
      - \exception{segLimitSS}
      - \exception{nonCanonSS}
    "#PF(fc)": \exception{pf}
    "#AC(0)": \exception{ac}
    "#UD": \exception{lockNoMem}
